<!DOCTYPE html>
<html>
<head>
	<title></title>
    <link href="http://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" rel="stylesheet">

	<link rel="stylesheet" href="css/utilities.css">
	<script type="text/javascript" src="http://cdn.kendostatic.com/2014.1.528/js/jquery.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
	<script type="text/javascript" src="../../js/definition.js"></script>
	<script type="text/javascript" src="js/include_utilities.js"></script>
</head>
</head>
<body>
<div class="container">
	<div id="config"></div>
</div>



<script type="text/javascript">



console.log(policy_ios)

var enabled_policy = [
	'general',
	'passcode',
	'restrictions',
	'wifi',
	'vpn',
	'email',
	'exchange_activesync',
	'ldap',
	'calendar',
	'subscribed_calendar',
	'contacts',
	'web_clips',
	'credentials',
	'scep',
	'mobile_device_management',
	'apn'
]
var style = {
	tabs: true
}
var tab_header = $('<ul/>');
var form_elements = $('#config')
var forms = [];

$.each(policy_ios, function(k,v){
	if($.inArray(v.name, enabled_policy) >= 0){
		var form = getElem(v.type, v);
		if((Object.keys(v.value).length >= 1)){
			$.each(v.value, function(k1,v1){
				form.append(getElem(v1.type, v1))
				if(typeof v1.value == 'undefined'){
					if(typeof v1.value == 'object' && (Object.keys(v1.value).length >= 1))
					$.each(v1.value, function(k2,v2){
						if(typeof v2.value != 'undefined'){
							if(typeof v2.value == 'object' && (Object.keys(v2.value).length >= 1))
							form.append(getElem(v2.type, v2))
							$.each(v2.value, function(k3,v3){
								if(typeof v3.value != 'undefined'){
									if(typeof v3.value == 'object' && (Object.keys(v3.value).length >= 1))
									form.append(getElem(v3.type, v3))
									$.each(v3.value, function(k4,v4){
										if(typeof v4.value != 'undefined'){
											if(typeof v4.value == 'object' && (Object.keys(v4.value).length >= 1))
											form.append(getElem(v4.type, v4))
										}
									})	
								}
							})
						}
					})		
				}
			})
		}
	}
	if(style.tabs == true){
		form = $('<div/>').attr('class', 'form').attr('id', v.name).append(form);
		tab_header.append(tabHeader(v));
	}
	forms.push(form)
})
form_elements.append($('<div class="forms"/>').append(forms));
form_elements.prepend(tab_header);
form_elements.tabs().addClass( "ui-tabs-vertical ui-helper-clearfix" );

function tabHeader(val){
	return $('<li/>').append($('<a/>').html(val.title).attr('href', '#'+val.name))
}


function getElem(type,val){
	var subelem, pushElem, option='', selectVal = [];
	var form_container = $('<div/>').attr('class', 'form_container');	
	var form_row = $('<div/>').attr('class', 'form_row');	
	var form_chain = $('<div/>').attr('class', 'form_chain active');	
	var form_section = $('<div/>').attr('class', 'form_section');
	var label = $('<label for="'+val.name+'"/>').html(val.title);
	var properties = (val.disabled)? 'disabled': '';
	properties = (val.checked)? properties+' checked': '';
	properties = (type == 'select-multiple')? properties+' multiple': properties;



	switch(type){
		case 'form':
			form_container.attr('data-title', val.title).attr('data-name', val.name);
			if(checkVal(val.title))
				form_container.append($('<span class="form_title"/>').html(val.title))
			if(checkVal(val.subtitle))
				form_container.append($('<span class="form_subtitle"/>').html(val.subtitle))
			if(checkVal(val.desc))
				form_container.append($('<span class="form_desc"/>').html(val.desc))
			form_row = form_container; // push to pushElem
		break;

		case 'section':
			form_section.attr('id', val.name);
			if(checkVal(val.title))
				form_section.append(label)
			if(checkVal(val.subtitle))
				form_section.append($('<span class="form_subtitle"/>').html(val.subtitle))
			if(checkVal(val.desc))
				form_section.append($('<span class="form_desc"/>').html(val.desc))

			$.each(val.value, function(k,v){
				form_row.append(getElem(v.type, v))
			})

			form_section.append(form_row)
			form_row = form_section; // push to pushElem
		break;

		case 'text':
		case 'button':
		case 'file':
		case 'checkbox':
		case 'radio':
		case 'password':
	// console.log(properties, (val.checked))
			form_row.append(label);
			form_row.append($('<input '+properties+'/>').attr('type', type).attr('name', val.name).attr('id', val.name).val(val.value));

			if(checkVal(val.desc))
				form_row.append($('<span class="form_desc"/>').html(val.desc))
		break;

		case 'textarea':
			form_row.append(label);
			form_row.append($('<textarea '+properties+'/>').attr('type', type).attr('name', val.name));
			if(checkVal(val.desc))
				form_row.append($('<span class="form_desc"/>').html(val.desc))
		break;

		case 'select':
		case 'select-multiple':
			form_row.append(label);
			$.each(val.value, function(k,v){
				if(typeof v != 'object'){
					option += '<option value="'+k+'">'+v+'</option>'
				} else {
					if(typeof v.title != 'undefined'){
						option += '<option value="'+k+'">'+v.title+'</option>'
					}
				}
			})
			form_row.append($('<select '+properties+'/>').attr('name', val.name).attr('id', val.name).append(option));

			if(checkVal(val.desc))
				form_row.append($('<span class="form_desc"/>').html(val.desc))
		break;

		case 'chain-checkbox':
			form_chain.attr('id', 'chain_'+val.name)
			form_row.append(label);
			form_row.append($('<input/>').attr('type', 'checkbox').attr('name', val.name).attr('id', val.name).bind('click', function(){
				if ($(this).is(':checked')) {
					$.each(selectVal[val.name], function(k,v){
						$('#'+v.name).removeAttr("disabled");
					})
				} else {
					form_chain.html('')
					$.each(selectVal[val.name], function(k,v){
						form_chain.append(getElem(v.type, v))
					})
				}
			}));
			selectVal[val.name] = val.chain_value;

			$.each(val.chain_value, function(k,v){
				form_chain.append(getElem(v.type, v))
			})

			if(checkVal(val.desc))
				form_row.append($('<span class="form_desc"/>').html(val.desc))

			form_row.append(form_chain)
		break;

		case 'chain-text':
			form_chain.attr('id', 'chain_'+val.name)
			form_row.append(label);
			form_row.append($('<input/>').attr('type', 'text').attr('name', val.name).attr('id', val.name).bind('blur', function(){
				if ($(this).val() != '') {
					$.each(selectVal[val.name], function(k,v){
						$('#'+v.name).removeAttr("disabled");
					})
				} else {
					form_chain.html('')
					$.each(selectVal[val.name], function(k,v){
						form_chain.append(getElem(v.type, v))
					})
				}
			}));
			selectVal[val.name] = val.chain_value;

			$.each(val.chain_value, function(k,v){
				form_chain.append(getElem(v.type, v))
			})

			if(checkVal(val.desc))
				form_row.append($('<span class="form_desc"/>').html(val.desc))

			form_row.append(form_chain)
		break;

		case 'chain-select':
			form_row.append(label)

			$.each(val.value, function(k,v){
				if(typeof v != 'object'){
					option += '<option value="'+k+'">'+v+'</option>'
				} else {
					if(typeof v.title != 'undefined'){
						option += '<option value="'+k+'">'+v.title+'</option>'
					} 
				}
			})

			form_row.append($('<select/>').attr('name', val.name).attr('id', val.name).append(option).bind("change", function() {
				var selected = $('option:selected', this)[0]['value'];
				form_chain.html('')
				$.each(selectVal[val.name][selected], function(k1,v1){
					form_chain.append(getElem(v1.type, v1))
				})
			}));

			if(checkVal(val.desc))
				form_row.append($('<span class="form_desc"/>').html(val.desc))

			$.each(val.chain_value, function(k,v){
				selectVal[val.name] = v.value;
				form_row.append(form_section.append(getElem(v.type, v)))
				$.each(v.value[0], function(k1,v1){
					form_chain.append(getElem(v1.type, v1))
				})
				// if(form_chain[0]['textContent'] != '')
				form_row.append(form_chain)
			})
		break;
	}
	pushElem = form_row;
	return  pushElem;
}

function checkVal(val){
	if(val != '' && typeof val != 'undefined'){
		return true;
	} else {		
		return false;
	}
}
</script>

</body>
</html>